// ============================================================================
// SMA / EMA Confirmed Signals + Alerts
//
// This TradingView Pine Script indicator identifies crossover signals between
// a short-term SMA and a longer-term EMA. It generates visual BUY and SELL
// markers on the chart and provides alert conditions suitable for automation.
//
// Features:
// 1. Configurable SMA and EMA lengths.
// 2. Bar-close confirmation to avoid false intrabar signals.
// 3. Persistent market state tracking to prevent duplicate signals.
// 4. Plotting of BUY/SELL signals directly on the chart.
// 5. Alert conditions for integration with TradingView alerts or webhook automation.
//
// Ideal for traders who want:
// - Clear, non-repainting crossover signals
// - Automation-ready alerts
// - Visual confirmation of trade signals before strategy conversion
// ============================================================================


//@version=5
indicator("SMA / EMA Confirmed Signals + Alerts", overlay=true)

// === Inputs ===
smaLength = input.int(20, "SMA Length")
emaLength = input.int(50, "EMA Length")

// === Calculations ===
smaValue = ta.sma(close, smaLength)
emaValue = ta.ema(close, emaLength)

// === Plot averages ===
plot(smaValue, color=color.blue, linewidth=2, title="SMA")
plot(emaValue, color=color.orange, linewidth=2, title="EMA")

// === Raw signals ===
buySignal  = ta.crossover(smaValue, emaValue)
sellSignal = ta.crossunder(smaValue, emaValue)

// === Confirm bar close ===
confirmedBuy  = buySignal  and barstate.isconfirmed
confirmedSell = sellSignal and barstate.isconfirmed

// === State handling ===
var int marketState = 0  // 0 = flat, 1 = long

finalBuy  = confirmedBuy  and marketState == 0
finalSell = confirmedSell and marketState == 1

if finalBuy
    marketState := 1

if finalSell
    marketState := 0

// === Plot signals ===
plotshape(finalBuy, title="BUY", style=shape.triangleup,
     location=location.belowbar, color=color.green, size=size.small, text="BUY")

plotshape(finalSell, title="SELL", style=shape.triangledown,
     location=location.abovebar, color=color.red, size=size.small, text="SELL")

// === Alerts ===
alertcondition(finalBuy, title="BUY Alert",
     message="BUY {{ticker}} @ {{close}}")

alertcondition(finalSell, title="SELL Alert",
     message="SELL {{ticker}} @ {{close}}")
